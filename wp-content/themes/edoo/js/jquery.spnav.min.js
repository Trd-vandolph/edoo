/**
 * Single Page Navigation Plugin for jQuery
 * Version: 0.1.2
 * Modified: 2012.03.18
 * Requirements: jQuery 1.7.1+
 * Author: Kazy @ nbnote.jp
 * License: Dual licensed under the MIT and GPL licenses.
 */

(function($){var k='spnav';var l={prefix:'spnav_',position:'left',fixed:false,shift:0,topMargin:0,topSpace:0,bottomMargin:0,bottomSpace:0,sideMargin:0,scrollDuration:500,scrollEaseType:'swing',followDuration:500,followDelay:0,followEaseType:'swing',onScrollFinished:function(){},onFollowFinished:function(){}};var m={_init:function(f,g){this.options=$.extend({},l,g);this.element=f;this.element.data(k,this);var h=this;var i=this.options;var j=this.element;h.win=$(window);h.st=$(document).scrollTop();h.ty=0;h.currentIndex=0;h.btnList=[];j.css({position:i.fixed?'fixed':'absolute',top:(i.topSpace>h.st)?i.topSpace+i.topMargin:h.st+i.topMargin}).children('li').each(function(){var a=$('a',this).off('click');var b=$(a[0].hash);var c=$(this).data('targetY',b.offset().top+i.shift).hover(function(){$(this).addClass(i.prefix+'state_hover')},function(){$(this).removeClass(i.prefix+'state_hover')}).click(function(e){e.preventDefault();var a=0;$('html,body').animate({scrollTop:$(this).data('targetY')},i.scrollDuration,i.scrollEaseType,function(){a++;if(a===2){setTimeout(function(){i.onScrollFinished.apply(h.btnList[h.currentIndex])},50)}})});var d=c.next('li')[0];if(d){c.data('nextY',$($('a',d)[0].hash).offset().top+i.shift)}else{c.data('nextY',b.offset().top+b.outerHeight(true))}h.btnList[h.btnList.length]=c});if(i.position==='left'){j.css({left:i.sideMargin})}else if(i.position==='right'){j.css({right:i.sideMargin})}h.win.scroll(function(){h._onUpdate()});h.win.resize(function(){h._onUpdate()});h._onUpdate();h._switchClassName()},_onUpdate:function(){var a=this;var b=this.options;var c=this.element;a.st=$(document).scrollTop();var d=c.outerHeight(true)+b.topMargin+b.bottomMargin;var e=c.offset().top;if(a.win.height()<d){if(e>a.st){a.ty=a.st}else if(a.st+a.win.height()>e+d){a.ty=a.st+a.win.height()-d}else{return}}else{a.ty=a.st}if(a.ty<b.topSpace)a.ty=b.topMargin+b.topSpace;else if(a.ty+d>$(document).outerHeight()-b.bottomSpace)a.ty=$(document).outerHeight()-b.bottomSpace-d;else a.ty+=b.topMargin;a._switchClassName();if(!b.fixed){c.stop(true).delay(b.followDelay).animate({top:a.ty},b.followDuration,b.followEaseType,function(){setTimeout(function(){b.onFollowFinished.apply(a.btnList[a.currentIndex])},50)})}else{c.css({top:a.ty-a.st})}},_switchClassName:function(){var a=this;var b=this.options;var i=0,len=a.btnList.length;for(i;i<len;i++){var c=a.btnList[i];var d=Math.floor(c.data('targetY'));var e=Math.floor(c.data('nextY'));if(a.st<d){c.removeClass(b.prefix+'state_current');c.removeClass(b.prefix+'state_up');c.addClass(b.prefix+'state_down')}else if(a.st>=d&&a.st<e){c.addClass(b.prefix+'state_current');c.removeClass(b.prefix+'state_up');c.removeClass(b.prefix+'state_down');a.currentIndex=i}else if(a.st>=e){c.removeClass(b.prefix+'state_current');c.addClass(b.prefix+'state_up');c.removeClass(b.prefix+'state_down')}else{return}}}};$[k]=function(){};$.extend($[k].prototype,m);$.fn[k]=function(a){if(m[a]&&a.charAt(0)!=='_'){var b=arguments;if(a.substr(0,3)==='get'){return m[a].apply($(this).data(k),Array.prototype.slice.call(b,1))}else{return this.each(function(){m[a].apply($(this).data(k),Array.prototype.slice.call(b,1))})}}else if(typeof a==="object"||!a){return this.each(function(){new $[k]()._init($(this),a)})}else{$.error("Method "+a+" does not exist on jQuery."+k)}}})(jQuery);

